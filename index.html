<!DOCTYPE html>
<html>
<head>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden;
            background: #000; font-family: 'Arial', sans-serif;
        }

        /* SHARED BACKGROUND */
        #master-container {
            width: 100%; height: 100%;
            background-image: url("https://cdnb.artstation.com/p/assets/images/images/011/445/369/large/remi-delmotte-hueco-mundo.jpg?1529609712&dl=1");
            background-size: cover; background-position: center;
            position: relative;
        }

        /* OVERLAYS */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.7); color: white; z-index: 100;
        }

        .menu-btn {
            background: #1d4ed8; color: white; border: 3px solid white;
            padding: 15px 40px; margin: 10px; font-size: 20px; cursor: pointer;
            width: 250px; border-radius: 8px;
        }

        /* LOADING BAR */
        #load-bar { width: 250px; height: 15px; border: 2px solid white; margin-top: 10px; }
        #load-fill { width: 0%; height: 100%; background: #60a5fa; }

        /* GAME STUFF */
        #game-layer { display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
        
        #sonic {
            position: absolute; width: 140px; height: 140px;
            background: url(https://docs.google.com/drawings/d/e/2PACX-1vSU2kymmebcoyonKiAeVWtczSiq12r7yeOqHpCD1P40lBrVvg-8P1cCEvyPFQMyNMn5G2g4cHHJT0Gz/pub?w=960&h=720);
            background-size: 960px 720px; background-position: left 0in top -1in;
            top: 350px; left: 50px; z-index: 10;
        }

        #ring {
            position: absolute; width: 60px; height: 60px;
            background: url(https://docs.google.com/drawings/d/e/2PACX-1vSU2kymmebcoyonKiAeVWtczSiq12r7yeOqHpCD1P40lBrVvg-8P1cCEvyPFQMyNMn5G2g4cHHJT0Gz/pub?w=960&h=720);
            background-size: 960px 720px; background-position: left -1in top 0in;
            display: none;
        }

        #score-board { position: absolute; top: 20px; left: 20px; color: #facc15; font-size: 30px; font-weight: bold; text-shadow: 2px 2px #000; }
    </style>
</head>
<body>

<div id="master-container">
    <div id="menu-view" class="overlay">
        <h1>KOSHISH SONIC</h1>
        <button class="menu-btn" onclick="startLoadingPhase()">PLAY GAME</button>
        <button class="menu-btn" onclick="alert('Score: ' + (localStorage.getItem('sonic_score') || 0))">HIGH SCORE</button>
    </div>

    <div id="loading-view" class="overlay" style="display:none;">
        <h2>LOADING...</h2>
        <div id="load-bar"><div id="load-fill"></div></div>
    </div>

    <div id="game-layer">
        <div id="score-board">RINGS: <span id="r-val">0</span></div>
        <div id="sonic"></div>
        <div id="ring"></div>
    </div>
</div>

<script>
    var ringCount = 0;
    var audio = new Audio('https://docs.google.com/uc?export=download&id=1ETKypIjRUWk4m4rle2X9nihfnzY7Ur4C');

    // PHASE 1: LOADING
    function startLoadingPhase() {
        $("#menu-view").hide();
        $("#loading-view").show();
        
        var p = 0;
        var t = setInterval(function() {
            p += 5;
            $("#load-fill").css("width", p + "%");
            if(p >= 100) {
                clearInterval(t);
                runGameNow();
            }
        }, 50);
    }

    // PHASE 2: RUN GAME
    function runGameNow() {
        $("#loading-view").fadeOut();
        $("#game-layer").show();
        
        // Start the Ring Drop
        dropRing();

        // Key Listeners
        $(document).keydown(function(e) {
            var s = $("#sonic").position();
            if(e.keyCode == 39) { // Right
                $("#sonic").css({"left": s.left + 50, "transform": "scaleX(1)"});
            }
            if(e.keyCode == 37) { // Left
                $("#sonic").css({"left": s.left - 50, "transform": "scaleX(-1)"});
            }
        });
    }

    // RING LOGIC
    function dropRing() {
        var winW = $(window).width() - 100;
        var startX = Math.floor(Math.random() * winW);
        
        $("#ring").stop().css({"top": "-60px", "left": startX, "display": "block"});
        
        $("#ring").animate({ top: "450px" }, 2500, "linear", function() {
            var sLeft = $("#sonic").position().left;
            var rLeft = $("#ring").position().left;

            // Simple Hitbox
            if (Math.abs(sLeft - rLeft) < 70) {
                ringCount++;
                $("#r-val").text(ringCount);
                audio.play();
                localStorage.setItem('sonic_score', ringCount);
            }
            
            dropRing(); // Loop
        });
    }
</script>

</body>
</html>
